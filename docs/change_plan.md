# 変更の方法と解説（初心者向け）

## 1. 掲示板一覧：ログインしたユーザーだけが見れる + 「投稿する」ボタン

### やりたいこと
- 掲示板一覧は**ログインしている人だけ**が開けるようにする。
- 掲示板一覧の画面に「**投稿する**」ボタンを置く。

### 変更の考え方
- **認証**：`PostsController` で「掲示板一覧（index）」を開くときに、`authenticate_user!` を**通す**ようにする。  
  → 今は `skip_before_action` で index が未ログインでも見れるので、index を skip から**外す**。
- **ボタン**：`app/views/posts/index.html.erb` で、掲示板一覧のとき（`@my_posts` が false のとき）だけ「投稿する」リンクを表示する。

### 変更するファイル
- `app/controllers/posts_controller.rb` … index を skip から外す。
- `app/views/posts/index.html.erb` … 「投稿する」ボタンを追加。

---

## 2. マイページ：自分用の投稿一覧 + 体重記録とカレンダー

### やりたいこと
- マイページに「**自分しか見れない投稿一覧**」を出して、記録として使えるようにする。
- **体重記録**を付けられるようにする。
- カレンダーの中に**体重の数字**を表示する。

### 変更の考え方
- **自分だけの投稿一覧**：いまのマイページ（`users#show`）で、`@user == current_user` のときだけ「自分の投稿一覧（記録用）」のブロックを表示する。表示している `@posts` は「そのユーザーの投稿」なので、自分で見ているときは「自分だけの記録一覧」になる。
- **体重記録**：日付ごとに体重を1件保存できるようにする。
  - **Weight モデル**：`user_id`（誰の記録か）、`date`（日付）、`value`（体重）を持つ。
  - **WeightsController**：体重の登録・削除など。
  - マイページ（自分のときだけ）に「体重を記録するフォーム」と「カレンダー」を置く。
- **カレンダー**：1か月分のカレンダーを表形式で表示し、その日に体重があれば**その数字**をマスの中に表示する。

### 変更するファイル
- `db/migrate/xxx_create_weights.rb` … 体重用テーブル（新規）
- `app/models/weight.rb` … Weight モデル（新規）
- `app/models/user.rb` … `has_many :weights` を追加
- `config/routes.rb` … 体重用ルート（例: `resources :weights` または user にネスト）
- `app/controllers/weights_controller.rb` … 体重の create/destroy など（新規）
- `app/views/users/show.html.erb` … 自分用の投稿一覧ブロック・体重フォーム・カレンダーを追加
- `app/views/weights/` … 必要なら部分テンプレート（カレンダー部分など）

---

## 3. 体重記録：モデルとカレンダー表示

### やりたいこと
- 日付と体重を保存する。
- カレンダー上に、その日の体重の数字を表示する。

### 変更の考え方
- **テーブル**：`weights` に `user_id`, `date`, `value` を入れる。`date` は「その日」を表す日付型1つ（1日1件想定）。
- **カレンダー**：Ruby の `Date` で「その月の1日」と「月末」を出し、1日〜月末までを 7 列（曜日）の表に並べる。各セルで「その日の `Weight` があるか」を調べ、あれば `value` を表示する。
- 月を切り替えたい場合は、`params[:year]`, `params[:month]` で表示月を変える。

### 変更するファイル
- 上記の Weight モデル・マイグレーション・WeightsController。
- マイページ（または専用ページ）にカレンダー用の HTML と、体重表示ロジックを書く。

---

## 4. ストーリー一覧：プロローグのリンク

### やりたいこと
- 「ストーリー一覧」画面を作り、今後ストーリーを解放していけるようにする。
- まずは**プロローグ**のリンクを用意する。

### 変更の考え方
- **ストーリー一覧**：`StoriesController#index` で「ストーリー一覧」画面を表示し、その中に「プロローグ」へのリンクを1本出す。
- **プロローグ**：`StoriesController#show` で `params[:id]` や `params[:slug]` が「prologue」のときプロローグ用のビューを表示。中身は固定テキストでよい。
- あとから「第1話」「第2話」を増やすときは、同じ `show` に id/slug を足していけばよい。

### 変更するファイル
- `config/routes.rb` … `get 'stories', ...` と `get 'stories/:slug', ...`（または :id）を追加。
- `app/controllers/stories_controller.rb` … index と show（新規）
- `app/views/stories/index.html.erb` … ストーリー一覧 + プロローグリンク（新規）
- `app/views/stories/show.html.erb` … プロローグ用の表示（新規）
- ヘッダーの「ストーリー一覧」を `stories_path` に変更（まだなら）。

---

## コードの書き方のポイント（初心者向け）

1. **「誰に見せるか」**  
   ログイン必須にしたい画面は、`authenticate_user!` をかける（skip しない）。  
   自分だけ見せるブロックは、ビューで `if @user == current_user` を使う。

2. **「何を保存するか」**  
   体重のように「ユーザーごと・日付ごとの値」を残すときは、  
   - モデル（Weight）とテーブル（weights）を作る  
   - `User` に `has_many :weights` を書く  
   と、ユーザーに紐づいた体重を扱いやすくなる。

3. **「画面の役割」**  
   掲示板一覧 = みんなの投稿を見る場所、マイページ = 自分のプロフィール＋自分の投稿一覧＋体重記録、ストーリー一覧 = ストーリーの入口、というように役割を分けておくと、どのコントローラ・ビューを触るかが分かりやすい。

4. **「あとから拡張する」**  
   ストーリーはまずプロローグだけリンクで用意し、あとから話を増やしていく形にすると、変更の方法がわかりやすい。

---

## 実装後の作業（あなたがやること）

1. **体重テーブルを作る**  
   ターミナルで以下を実行してください。
   ```bash
   cd "C:\Users\prima\Desktop\My Diet Story"
   bin/rails db:migrate
   ```
   `db/migrate/20260201140000_create_weights.rb` が実行され、`weights` テーブルが作成されます。

2. **動作確認**  
   - 掲示板一覧：未ログインで開くとログイン画面に飛ぶこと、ログイン後は「投稿する」ボタンが出ること。
   - マイページ：自分のページだけ「体重記録」「自分の投稿一覧（記録）」が出ること。他人のページには出ないこと。
   - ストーリー一覧：「プロローグ」リンクからプロローグが開くこと。

3. **プロローグの本文**  
   `app/views/stories/show.html.erb` の「ここにプロローグの本文を書きます」の部分を、実際のプロローグ文に差し替えてください。
